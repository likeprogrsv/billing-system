# Тестирование

## Быстрый старт

```bash
# Запуск всех тестов
pytest

# С подробным выводом
pytest -v

# Конкретная категория
pytest billing/tests/test_models.py -v
pytest billing/tests/test_conversion_api.py -v
```

## Результаты

**34 теста** покрывают все критичные сценарии:

### ✅ API тесты (18 тестов)

**Conversion API (9 тестов):**
- Успешные конвертации RUB ↔ USD
- Проверка балансов после операций
- Недостаточно средств
- Валидация входных данных
- Граничные случаи

**Service Spend API (5 тестов):**
- Покупка в RUB
- Покупка с конвертацией
- Проверка достаточности средств
- Валидация обязательных полей

**Account Top-Up API (4 теста):**
- Пополнение в RUB
- Пополнение с конвертацией
- Валидация данных

### ✅ Model тесты (16 тестов)

**Balance Model (9 тестов):**
- `deposit()` - пополнение баланса
- `withdraw()` - списание с баланса
- `check_sufficient_balance()` - проверка достаточности средств
- Сохранение точности Decimal
- Комбинации операций

**Transaction Model (4 теста):**
- Создание транзакций с полями
- Отображение типов транзакций
- Строковое представление

**Currency Model (3 теста):**
- Создание валюты
- Уникальность кода валюты
- Строковое представление

## Структура тестов

```
billing/tests/
├── conftest.py                    # Fixtures (api_client, currencies, balances)
├── test_conversion_api.py         # Тесты конвертации (9)
├── test_service_spend_api.py      # Тесты покупки услуг (5)
├── test_account_topup_api.py      # Тесты пополнения (4)
└── test_models.py                 # Тесты моделей (16)
```

## Fixtures

- `api_client` - DRF APIClient для запросов
- `currencies` - RUB и USD валюты
- `balances` - Начальные балансы (RUB: 100000, USD: 1000)

Все тесты используют изолированную тестовую БД.
